[{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\admin\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\admin\\reports\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\admin\\users\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\api\\checkout\\session\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1478,1481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1478,1481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculateApplicationFee' is defined but never used.","line":56,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport Stripe from 'stripe'\r\n\r\n// Mark this route as dynamic to prevent it from being prerendered at build time\r\nexport const dynamic = 'force-dynamic'\r\n\r\nfunction getStripe() {\r\n  if (!process.env.STRIPE_SECRET_KEY) {\r\n    throw new Error('STRIPE_SECRET_KEY is not set')\r\n  }\r\n  return new Stripe(process.env.STRIPE_SECRET_KEY, {\r\n    apiVersion: '2024-06-20',\r\n  })\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  const stripe = getStripe()\r\n  try {\r\n    const { ticketId, priceId } = await req.json()\r\n\r\n    // In real app, fetch ticket details from Supabase\r\n    const session = await stripe.checkout.sessions.create({\r\n      payment_method_types: ['card'],\r\n      line_items: [\r\n        {\r\n          price: priceId,\r\n          quantity: 1,\r\n        },\r\n      ],\r\n      mode: 'payment',\r\n      success_url: `${process.env.NEXT_PUBLIC_APP_URL}/guardian/tickets?success=true&session_id={CHECKOUT_SESSION_ID}`,\r\n      cancel_url: `${process.env.NEXT_PUBLIC_APP_URL}/guardian/tickets?canceled=true`,\r\n      metadata: {\r\n        ticketId,\r\n      },\r\n      // Application fee for platform (螳滄圀縺ｮ螳溯｣・〒縺ｯConnected Account繧剃ｽｿ逕ｨ)\r\n      // payment_intent_data: {\r\n      //   application_fee_amount: calculateApplicationFee(amount),\r\n      //   transfer_data: {\r\n      //     destination: teacherStripeAccountId,\r\n      //   },\r\n      // },\r\n    })\r\n\r\n    return NextResponse.json({ sessionId: session.id })\r\n  } catch (error: any) {\r\n    console.error('Stripe session creation error:', error)\r\n    return NextResponse.json(\r\n      { error: error.message },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// Helper function to calculate platform fee\r\nfunction calculateApplicationFee(amount: number, teacherPlan: 'free' | 'pro' = 'free'): number {\r\n  const feePercent = teacherPlan === 'pro' ? \r\n    parseInt(process.env.EDBRIO_PLATFORM_FEE_PERCENT_PRO!) : \r\n    parseInt(process.env.EDBRIO_PLATFORM_FEE_PERCENT_FREE!)\r\n  \r\n  const minFee = parseInt(process.env.EDBRIO_MIN_FEE_JPY!) * 100 // Convert to cents\r\n  const calculatedFee = Math.round(amount * (feePercent / 100))\r\n  \r\n  return Math.max(calculatedFee, minFee)\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\guardian\\booking\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showConfirmation' is assigned a value but never used.","line":43,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3852,3855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3852,3855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport { Clock, MapPin, Check } from 'lucide-react'\r\nimport { format, addDays, isSameDay, startOfWeek } from 'date-fns'\r\nimport { ja } from 'date-fns/locale'\r\nimport { createClient } from '@/lib/supabase/client'\r\n\r\ntype AvailabilityRow = {\r\n  id: string\r\n  teacher_id: string\r\n  slot_start: string\r\n  slot_end: string\r\n  is_bookable: boolean\r\n}\r\n\r\ntype TeacherRow = {\r\n  id: string\r\n  handle: string\r\n  subjects: string[]\r\n  grades: string[]\r\n}\r\n\r\ntype TicketBalanceRow = {\r\n  id: string\r\n  student_id: string\r\n  ticket_id: string\r\n  remaining_minutes: number\r\n  expires_at: string | null\r\n  tickets?: { id: string; name: string } | null\r\n}\r\n\r\nexport default function BookingPage() {\r\n  const [selectedTeacher, setSelectedTeacher] = useState<string>('all')\r\n  const [currentWeek, setCurrentWeek] = useState(new Date())\r\n  const [selectedSlot, setSelectedSlot] = useState<AvailabilityRow | null>(null)\r\n  const [selectedTicket, setSelectedTicket] = useState<string>('')\r\n  const [showConfirmation, setShowConfirmation] = useState(false)\r\n  const [teachers, setTeachers] = useState<TeacherRow[]>([])\r\n  const [avail, setAvail] = useState<AvailabilityRow[]>([])\r\n  const [tickets, setTickets] = useState<TicketBalanceRow[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setLoading(true)\r\n        setError(null)\r\n        if (process.env.NEXT_PUBLIC_DISABLE_DATA_FETCH === 'true') {\r\n          if (mounted) {\r\n            setTeachers([])\r\n            setAvail([])\r\n            setTickets([])\r\n            setLoading(false)\r\n          }\r\n          return\r\n        }\r\n\r\n        const { data: ts, error: tErr } = await supabase\r\n          .from('teachers')\r\n          .select('id,handle,subjects,grades')\r\n          .limit(100)\r\n        if (tErr) throw tErr\r\n        if (mounted) setTeachers(ts || [])\r\n\r\n        const start = new Date()\r\n        const end = addDays(start, 7)\r\n        const { data: av, error: aErr } = await supabase\r\n          .from('availability')\r\n          .select('id,teacher_id,slot_start,slot_end,is_bookable')\r\n          .gte('slot_start', start.toISOString())\r\n          .lte('slot_start', end.toISOString())\r\n          .eq('is_bookable', true)\r\n          .order('slot_start', { ascending: true })\r\n        if (aErr) throw aErr\r\n        if (mounted) setAvail(av || [])\r\n\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (uid) {\r\n          const { data: students, error: sErr } = await supabase\r\n            .from('students')\r\n            .select('id')\r\n            .eq('guardian_id', uid)\r\n          if (sErr) throw sErr\r\n          const studentIds = (students || []).map((s) => s.id)\r\n          if (studentIds.length > 0) {\r\n            const { data: tb, error: tbErr } = await supabase\r\n              .from('ticket_balances')\r\n              .select('id,student_id,ticket_id,remaining_minutes,expires_at')\r\n              .in('student_id', studentIds)\r\n              .order('expires_at', { ascending: true })\r\n            if (tbErr) throw tbErr\r\n            if (mounted) setTickets(tb || [])\r\n          }\r\n        }\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load()\r\n    return () => {\r\n      mounted = false\r\n    }\r\n  }, [supabase])\r\n\r\n  const weekStart = startOfWeek(currentWeek, { weekStartsOn: 1 })\r\n  const weekDays = Array.from({ length: 7 }, (_, i) => addDays(weekStart, i))\r\n\r\n  const filtered = avail.filter((s) => selectedTeacher === 'all' || s.teacher_id === selectedTeacher)\r\n  const getSlotsForDate = (date: Date) => filtered.filter((s) => isSameDay(new Date(s.slot_start), date))\r\n\r\n  const getAvailableTickets = () => tickets\r\n\r\n  const handleBookSlot = async () => {\r\n    if (!selectedSlot || !selectedTicket) return\r\n    console.log('Booking request:', {\r\n      slotId: selectedSlot.id,\r\n      teacherId: selectedSlot.teacher_id,\r\n      ticketBalanceId: selectedTicket,\r\n      start: selectedSlot.slot_start,\r\n      end: selectedSlot.slot_end,\r\n    })\r\n    setShowConfirmation(true)\r\n  }\r\n\r\n  const resetBooking = () => {\r\n    setSelectedSlot(null)\r\n    setSelectedTicket('')\r\n    setShowConfirmation(false)\r\n  }\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={['guardian']}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">莠育ｴ・/h1>\r\n          <p className=\"text-gray-600\">蜈育函縺ｮ遨ｺ縺肴凾髢薙°繧我ｺ育ｴ・＠縺ｦ縺上□縺輔＞</p>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">\r\n            繝・・繧ｿ蜿門ｾ励〒繧ｨ繝ｩ繝ｼ縺檎匱逕溘＠縺ｾ縺励◆: {error}\r\n          </div>\r\n        )}\r\n\r\n        <Card className=\"mb-8\">\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"grid md:grid-cols-3 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium mb-2\">蜈育函繧堤ｵ槭ｊ霎ｼ縺ｿ</label>\r\n                <Select value={selectedTeacher} onValueChange={setSelectedTeacher}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"蜈育函繧帝∈謚杤" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"all\">縺吶∋縺ｦ縺ｮ蜈育函</SelectItem>\r\n                    {teachers.map((t) => (\r\n                      <SelectItem key={t.id} value={t.id}>{t.handle}</SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              <div className=\"flex items-end\">\r\n                <Button variant=\"outline\" onClick={() => setCurrentWeek(new Date())}>莉企ｱ縺ｫ謌ｻ繧・/Button>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-7 gap-4\">\r\n          {weekDays.map((date) => (\r\n            <Card key={date.toISOString()}>\r\n              <CardHeader>\r\n                <CardTitle className=\"text-sm font-medium\">\r\n                  {format(date, 'M譛・譌･(E)', { locale: ja })}\r\n                </CardTitle>\r\n                <CardDescription>遨ｺ縺肴棧</CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {loading ? (\r\n                  <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n                ) : (\r\n                  <div className=\"space-y-2\">\r\n                    {getSlotsForDate(date).map((slot) => (\r\n                      <div\r\n                        key={slot.id}\r\n                        className=\"p-2 border rounded hover:bg-gray-50 cursor-pointer\"\r\n                        onClick={() => setSelectedSlot(slot)}\r\n                      >\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div>\r\n                            <div className=\"font-medium\">隰帛ｸｫID: {slot.teacher_id}</div>\r\n                          </div>\r\n                          <div className=\"text-sm\">\r\n                            {format(new Date(slot.slot_start), 'HH:mm', { locale: ja })}\r\n                            <span className=\"mx-1\">-</span>\r\n                            {format(new Date(slot.slot_end), 'HH:mm', { locale: ja })}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"text-xs text-gray-600 mt-1\">\r\n                          <span className=\"inline-flex items-center\"><MapPin className=\"w-3 h-3 mr-1\" />繧ｪ繝ｳ繝ｩ繧､繝ｳ</span>\r\n                          <span className=\"mx-2\">窶｢</span>\r\n                          <span className=\"inline-flex items-center\"><Clock className=\"w-3 h-3 mr-1\" />\r\n                            {Math.max(0, Math.round((new Date(slot.slot_end).getTime() - new Date(slot.slot_start).getTime()) / 60000))}蛻・r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n\r\n        <Dialog open={!!selectedSlot} onOpenChange={() => setSelectedSlot(null)}>\r\n          <DialogContent>\r\n            <DialogHeader>\r\n              <DialogTitle>莠育ｴ・・螳ｹ縺ｮ遒ｺ隱・/DialogTitle>\r\n              <DialogDescription>\r\n                {selectedSlot && (\r\n                  <div className=\"mt-2 text-sm text-gray-700\">\r\n                    <div>隰帛ｸｫID: {selectedSlot.teacher_id}</div>\r\n                    <div className=\"mt-1\">\r\n                      譌･譎・ {format(new Date(selectedSlot.slot_start), 'M譛・譌･(E) HH:mm', { locale: ja })}\r\n                      {' - '}\r\n                      {format(new Date(selectedSlot.slot_end), 'HH:mm', { locale: ja })}\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            {selectedSlot && (\r\n              <div className=\"space-y-3\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-2\">繝√こ繝・ヨ繧帝∈謚・/label>\r\n                  <Select value={selectedTicket} onValueChange={setSelectedTicket}>\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"繝√こ繝・ヨ繧帝∈謚杤" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {getAvailableTickets().map((t) => (\r\n                        <SelectItem key={t.id} value={t.id}>\r\n                          {t.ticket_id}・域ｮ九ｊ{t.remaining_minutes}蛻・t.expires_at ? `縲∵悄髯・ ${format(new Date(t.expires_at), 'PPP', { locale: ja })}` : ''}・噂r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                <div className=\"flex justify-end gap-2\">\r\n                  <Button variant=\"outline\" onClick={resetBooking}>繧ｭ繝｣繝ｳ繧ｻ繝ｫ</Button>\r\n                  <Button onClick={handleBookSlot} disabled={!selectedTicket}>\r\n                    <Check className=\"w-4 h-4 mr-1\" /> 莠育ｴ・｢ｺ螳喀r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\guardian\\bookings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1800,1803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1800,1803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { format } from 'date-fns'\r\nimport { ja } from 'date-fns/locale'\r\n\r\ntype BookingRow = {\r\n  id: string\r\n  start_time: string\r\n  end_time: string\r\n  status: 'pending' | 'confirmed' | 'canceled' | 'done'\r\n  teacher_id: string\r\n}\r\n\r\nexport default function GuardianBookingsPage() {\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [items, setItems] = useState<BookingRow[]>([])\r\n\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setError(null)\r\n        setLoading(true)\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (!uid) { setItems([]); return }\r\n\r\n        const { data: students, error: sErr } = await supabase\r\n          .from('students')\r\n          .select('id')\r\n          .eq('guardian_id', uid)\r\n        if (sErr) throw sErr\r\n        const studentIds = (students || []).map(s => s.id)\r\n\r\n        if (studentIds.length > 0) {\r\n          const { data, error: bErr } = await supabase\r\n            .from('bookings')\r\n            .select('id,start_time,end_time,status,teacher_id')\r\n            .in('student_id', studentIds)\r\n            .order('start_time', { ascending: false })\r\n            .limit(100)\r\n          if (bErr) throw bErr\r\n          if (mounted) setItems(data || [])\r\n        } else {\r\n          if (mounted) setItems([])\r\n        }\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load()\r\n    return () => { mounted = false }\r\n  }, [supabase])\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={[\"guardian\"]}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <h1 className=\"text-2xl font-bold mb-4\">莠育ｴ・ｱ･豁ｴ</h1>\r\n        {error && (\r\n          <div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">{error}</div>\r\n        )}\r\n        {loading ? (\r\n          <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n        ) : items.length === 0 ? (\r\n          <div className=\"text-gray-500\">莠育ｴ・・縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {items.map((b) => (\r\n              <Card key={b.id}>\r\n                <CardHeader><CardTitle className=\"text-sm\">隰帛ｸｫID: {b.teacher_id}</CardTitle></CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-sm text-gray-700\">\r\n                    {format(new Date(b.start_time), 'PPP p', { locale: ja })} - {format(new Date(b.end_time), 'p', { locale: ja })}\r\n                    <span className=\"ml-2 inline-block rounded px-2 py-0.5 text-xs border\">{b.status}</span>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\guardian\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":8,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createClient' is defined but never used.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BookingRow' is defined but never used.","line":18,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ReportRow' is defined but never used.","line":19,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dbUser' is assigned a value but never used.","line":22,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'availableTickets' is assigned a value but never used.","line":24,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":53,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport Link from 'next/link'\r\nimport { Calendar, Clock, CreditCard, FileText, UserPlus, ShoppingCart } from 'lucide-react'\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { format } from 'date-fns'\r\nimport { ja } from 'date-fns/locale'\r\nimport { useAuth } from '@/hooks/use-auth'\r\nimport { useBookings } from '@/hooks/use-bookings'\r\nimport { useTickets } from '@/hooks/use-tickets'\r\nimport { useReports } from '@/hooks/use-reports'\r\nimport { Booking, TicketBalance, Report } from '@/lib/types/database'\r\n\r\ntype BookingRow = { id: string; start_time: string; end_time: string; status: 'pending' | 'confirmed' | 'canceled' | 'done'; teacher_id: string }\r\ntype ReportRow = { id: string; booking_id: string; published_at: string | null; content_public: string | null }\r\n\r\nexport default function GuardianHome() {\r\n  const { user, dbUser, loading: authLoading } = useAuth()\r\n  const { bookings, loading: bookingsLoading } = useBookings(user?.id, 'guardian')\r\n  const { tickets: availableTickets, balances, loading: ticketsLoading } = useTickets(user?.id, 'guardian')\r\n  const { reports, loading: reportsLoading } = useReports(user?.id, 'guardian')\r\n\r\n  const stats = useMemo(() => {\r\n    const upcomingList = bookings.filter((b: Booking) => new Date(b.start_time) > new Date())\r\n    const nextVal = upcomingList[0] ? format(new Date(upcomingList[0].start_time), 'PPP p', { locale: ja }) : '-'\r\n    const nextDesc = upcomingList[0] ? `隰帛ｸｫID: ${upcomingList[0].teacher_id}` : '-'\r\n\r\n    const totalMin = balances.reduce((a: number, b: TicketBalance) => a + (b.remaining_minutes || 0), 0)\r\n    const nearest = [...balances]\r\n      .filter((tb: TicketBalance) => tb.expires_at)\r\n      .sort((a, b) => new Date(a.expires_at!).getTime() - new Date(b.expires_at!).getTime())[0]\r\n    const balanceValue = `${totalMin}蛻・\r\n    const balanceDesc = nearest?.expires_at ? `譛遏ｭ譛滄剞: ${format(new Date(nearest.expires_at), 'PPP', { locale: ja })}` : '-'\r\n\r\n    const newReportsCount = String(reports.length)\r\n    const uniqueTeachers = new Set(bookings.map((b: Booking) => b.teacher_id))\r\n\r\n    return [\r\n      { title: '谺｡縺ｮ莠育ｴ・, value: nextVal, description: nextDesc, icon: Clock, color: 'text-blue-600' },\r\n      { title: '菫晄怏繝√こ繝・ヨ', value: balanceValue, description: balanceDesc, icon: CreditCard, color: 'text-green-600' },\r\n      { title: '譁ｰ逹繝ｬ繝昴・繝・, value: newReportsCount, description: '譛霑代・蜈ｬ髢九Ξ繝昴・繝・, icon: FileText, color: 'text-purple-600' },\r\n      { title: '諡・ｽ謎ｸｭ縺ｮ蜈育函', value: `${uniqueTeachers.size}莠ｺ`, description: '-', icon: UserPlus, color: 'text-orange-600' },\r\n    ]\r\n  }, [bookings, balances, reports])\r\n\r\n  const upcoming = useMemo(() => bookings.filter((b: Booking) => new Date(b.start_time) > new Date()).slice(0, 5), [bookings])\r\n  const recentReports = useMemo(() => reports.slice(0, 10), [reports])\r\n\r\n  const loading = authLoading || bookingsLoading || ticketsLoading || reportsLoading\r\n  const error = null // Error handling could be improved by consolidating hook errors\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={['guardian']}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">繝帙・繝</h1>\r\n          <p className=\"text-gray-600\">縺泌ｮｶ蠎ｭ縺ｮ蟄ｦ鄙堤憾豕√ｒ遒ｺ隱阪＠縺ｾ縺励ｇ縺・/p>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">\r\n            繝・・繧ｿ蜿門ｾ励〒繧ｨ繝ｩ繝ｼ縺檎匱逕溘＠縺ｾ縺励◆: {error}\r\n          </div>\r\n        )}\r\n\r\n        {/* Stats Grid */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n          {stats.map((stat) => {\r\n            const Icon = stat.icon\r\n            return (\r\n              <Card key={stat.title}>\r\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                  <CardTitle className=\"text-sm font-medium text-gray-600\">\r\n                    {stat.title}\r\n                  </CardTitle>\r\n                  <Icon className={`h-4 w-4 ${stat.color}`} />\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-2xl font-bold\">{stat.value}</div>\r\n                  <p className=\"text-xs text-gray-600 mt-1\">{stat.description}</p>\r\n                </CardContent>\r\n              </Card>\r\n            )\r\n          })}\r\n        </div>\r\n\r\n        {/* Quick Actions */}\r\n        <div className=\"grid md:grid-cols-4 gap-4 mb-8\">\r\n          {[\r\n            { title: '譁ｰ隕丈ｺ育ｴ・, description: '蜈育函縺ｮ遨ｺ縺肴凾髢薙°繧我ｺ育ｴ・, href: '/guardian/booking', icon: Calendar, isPrimary: true },\r\n            { title: '繝√こ繝・ヨ雉ｼ蜈･', description: '謗域･ｭ縺ｧ菴ｿ縺・メ繧ｱ繝・ヨ', href: '/guardian/tickets', icon: ShoppingCart, isPrimary: false },\r\n            { title: '莠育ｴ・ｱ･豁ｴ', description: '驕主悉縺ｨ莉雁ｾ後・莠育ｴ・｢ｺ隱・, href: '/guardian/bookings', icon: Clock, isPrimary: false },\r\n            { title: '繝ｬ繝昴・繝・, description: '謗域･ｭ繝ｬ繝昴・繝医・遒ｺ隱・, href: '/guardian/reports', icon: FileText, isPrimary: false },\r\n          ].map((action) => {\r\n            const Icon = action.icon\r\n            return (\r\n              <Link key={action.title} href={action.href}>\r\n                <Card className={`cursor-pointer transition-all hover:shadow-md ${action.isPrimary ? 'border-blue-200 bg-blue-50' : ''}`}>\r\n                  <CardContent className=\"flex items-center p-6\">\r\n                    <Icon className={`h-8 w-8 mr-4 ${action.isPrimary ? 'text-blue-600' : 'text-gray-600'}`} />\r\n                    <div>\r\n                      <h3 className=\"font-semibold text-sm\">{action.title}</h3>\r\n                      <p className=\"text-xs text-gray-600 mt-1\">{action.description}</p>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              </Link>\r\n            )\r\n          })}\r\n        </div>\r\n\r\n        <div className=\"grid lg:grid-cols-2 gap-8\">\r\n          {/* Upcoming Bookings */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>逶ｴ霑代・莠育ｴ・/CardTitle>\r\n              <CardDescription>莠亥ｮ壹＆繧後※縺・ｋ謗域･ｭ荳隕ｧ</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                {upcoming.map((b: Booking) => (\r\n                  <div key={b.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"font-medium\">\r\n                        {format(new Date(b.start_time), 'PPP p', { locale: ja })}\r\n                        <span className=\"mx-1\">-</span>\r\n                        {format(new Date(b.end_time), 'p', { locale: ja })}\r\n                      </div>\r\n                      <div className=\"text-xs text-gray-600 mt-1\">隰帛ｸｫID: {b.teacher_id}</div>\r\n                    </div>\r\n                    <div>\r\n                      {b.status === 'confirmed' ? (\r\n                        <Badge variant=\"default\" className=\"bg-green-100 text-green-800\">遒ｺ螳・/Badge>\r\n                      ) : (\r\n                        <Badge variant=\"secondary\">遒ｺ隱榊ｾ・■</Badge>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n                {upcoming.length === 0 && (\r\n                  <div className=\"text-gray-500\">莠亥ｮ壹・縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n                )}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Recent Reports */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>譛霑代・繝ｬ繝昴・繝・/CardTitle>\r\n              <CardDescription>譁ｰ縺励＞謗域･ｭ繝ｬ繝昴・繝・/CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                {recentReports.map((r: Report) => (\r\n                  <div key={r.id} className=\"p-4 border rounded-lg\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div className=\"font-semibold\">繝ｬ繝昴・繝・/div>\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-600 mt-1\">\r\n                      {r.published_at ? format(new Date(r.published_at), 'PPP', { locale: ja }) : '-'}\r\n                    </div>\r\n                    {r.content_public && (\r\n                      <p className=\"text-sm text-gray-700 mt-2 line-clamp-2\">{r.content_public}</p>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n                {recentReports.length === 0 && (\r\n                  <div className=\"text-gray-500\">譁ｰ縺励＞繝ｬ繝昴・繝医・縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n                )}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\guardian\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\guardian\\reports\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2138,2141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2138,2141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { format } from 'date-fns'\r\nimport { ja } from 'date-fns/locale'\r\n\r\ntype ReportRow = {\r\n  id: string\r\n  booking_id: string\r\n  published_at: string | null\r\n  content_public: string | null\r\n}\r\n\r\nexport default function GuardianReportsPage() {\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [items, setItems] = useState<ReportRow[]>([])\r\n\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setError(null)\r\n        setLoading(true)\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (!uid) { setItems([]); return }\r\n\r\n        const { data: students, error: sErr } = await supabase\r\n          .from('students')\r\n          .select('id')\r\n          .eq('guardian_id', uid)\r\n        if (sErr) throw sErr\r\n        const studentIds = (students || []).map(s => s.id)\r\n        if (studentIds.length === 0) { setItems([]); return }\r\n\r\n        // bookings for students\r\n        const { data: bookings, error: bErr } = await supabase\r\n          .from('bookings')\r\n          .select('id')\r\n          .in('student_id', studentIds)\r\n          .order('start_time', { ascending: false })\r\n          .limit(200)\r\n        if (bErr) throw bErr\r\n        const bookingIds = (bookings || []).map(b => b.id)\r\n        if (bookingIds.length === 0) { setItems([]); return }\r\n\r\n        const { data: reps, error: rErr } = await supabase\r\n          .from('reports')\r\n          .select('id,booking_id,published_at,content_public')\r\n          .in('booking_id', bookingIds)\r\n          .order('published_at', { ascending: false })\r\n          .limit(100)\r\n        if (rErr) throw rErr\r\n        if (mounted) setItems(reps || [])\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load()\r\n    return () => { mounted = false }\r\n  }, [supabase])\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={[\"guardian\"]}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <h1 className=\"text-2xl font-bold mb-4\">繝ｬ繝昴・繝・/h1>\r\n        {error && (\r\n          <div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">{error}</div>\r\n        )}\r\n        {loading ? (\r\n          <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n        ) : items.length === 0 ? (\r\n          <div className=\"text-gray-500\">繝ｬ繝昴・繝医・縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {items.map((r) => (\r\n              <Card key={r.id}>\r\n                <CardHeader>\r\n                  <CardTitle className=\"text-sm\">{r.published_at ? format(new Date(r.published_at), 'PPP', { locale: ja }) : '譛ｪ蜈ｬ髢・}</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-sm text-gray-700 line-clamp-3\">{r.content_public ?? '・亥・螳ｹ縺ｪ縺暦ｼ・}</div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\guardian\\tickets\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3107,3110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3107,3110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog'\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'\r\nimport { ShoppingCart } from 'lucide-react'\r\nimport { getStripe } from '@/lib/stripe'\r\nimport { createClient } from '@/lib/supabase/client'\r\n\r\ntype TicketRow = {\r\n  id: string\r\n  teacher_id: string\r\n  name: string\r\n  minutes: number\r\n  bundle_qty: number\r\n  price_cents: number\r\n  valid_days: number\r\n  is_active: boolean\r\n  stripe_price_id: string | null\r\n  teachers?: { id: string; handle: string } | null\r\n}\r\n\r\ntype TicketBalanceRow = {\r\n  id: string\r\n  ticket_id: string\r\n  remaining_minutes: number\r\n  purchased_at: string | null\r\n  expires_at: string | null\r\n  tickets?: { id: string; name: string; minutes: number; bundle_qty: number } | null\r\n}\r\n\r\nexport default function GuardianTickets() {\r\n  const [tickets, setTickets] = useState<TicketRow[]>([])\r\n  const [balances, setBalances] = useState<TicketBalanceRow[]>([])\r\n  const [selectedTicket, setSelectedTicket] = useState<TicketRow | null>(null)\r\n  const [showPurchaseDialog, setShowPurchaseDialog] = useState(false)\r\n  const [purchasing, setPurchasing] = useState(false)\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setLoading(true)\r\n        setError(null)\r\n        // Public tickets\r\n        const { data: ts, error: tErr } = await supabase\r\n          .from('tickets')\r\n          .select('id,teacher_id,name,minutes,bundle_qty,price_cents,valid_days,is_active,stripe_price_id')\r\n          .eq('is_active', true)\r\n          .order('price_cents', { ascending: true })\r\n        if (tErr) throw tErr\r\n        if (mounted) setTickets(ts || [])\r\n\r\n        // Balances for guardian's students\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (uid) {\r\n          const { data: students, error: sErr } = await supabase\r\n            .from('students')\r\n            .select('id')\r\n            .eq('guardian_id', uid)\r\n          if (sErr) throw sErr\r\n          const studentIds = (students || []).map((s) => s.id)\r\n          if (studentIds.length > 0) {\r\n            const { data: tb, error: bErr } = await supabase\r\n              .from('ticket_balances')\r\n              .select('id,ticket_id,remaining_minutes,purchased_at,expires_at')\r\n              .in('student_id', studentIds)\r\n              .order('expires_at', { ascending: true })\r\n            if (bErr) throw bErr\r\n            if (mounted) setBalances(tb || [])\r\n          }\r\n        }\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load()\r\n    return () => {\r\n      mounted = false\r\n    }\r\n  }, [supabase])\r\n\r\n  const formatPrice = (priceCents: number) =>\r\n    new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format((priceCents || 0) / 100)\r\n\r\n  const handlePurchase = async (ticket: TicketRow) => {\r\n    setSelectedTicket(ticket)\r\n    setShowPurchaseDialog(true)\r\n  }\r\n\r\n  const handleStripeCheckout = async () => {\r\n    if (!selectedTicket || !selectedTicket.stripe_price_id) return\r\n    setPurchasing(true)\r\n    try {\r\n      const stripe = await getStripe()\r\n      const res = await fetch('/api/checkout/session', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ ticketId: selectedTicket.id, priceId: selectedTicket.stripe_price_id }),\r\n      })\r\n      const data = await res.json()\r\n      if (data.sessionId) {\r\n        const { error } = await stripe.redirectToCheckout({ sessionId: data.sessionId })\r\n        if (error) console.error(error.message)\r\n      } else {\r\n        console.error('Failed to create checkout session', data)\r\n      }\r\n    } finally {\r\n      setPurchasing(false)\r\n      setShowPurchaseDialog(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={['guardian']}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">繝√こ繝・ヨ</h1>\r\n          <p className=\"text-gray-600\">繝√こ繝・ヨ縺ｮ雉ｼ蜈･縺ｨ谿矩ｫ倥ｒ邂｡逅・＠縺ｾ縺・/p>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">\r\n            繝・・繧ｿ蜿門ｾ励〒繧ｨ繝ｩ繝ｼ縺檎匱逕溘＠縺ｾ縺励◆: {error}\r\n          </div>\r\n        )}\r\n\r\n        {/* Available Tickets */}\r\n        <Card className=\"mb-8\">\r\n          <CardHeader>\r\n            <CardTitle>雉ｼ蜈･蜿ｯ閭ｽ縺ｪ繝√こ繝・ヨ</CardTitle>\r\n            <CardDescription>蜈育函縺斐→縺ｮ繝√こ繝・ヨ荳隕ｧ</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {loading ? (\r\n              <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n            ) : (\r\n              <div className=\"grid md:grid-cols-2 gap-4\">\r\n                {tickets.map((ticket) => (\r\n                  <Card key={ticket.id}>\r\n                    <CardHeader>\r\n                      <CardTitle className=\"flex items-center justify-between\">\r\n                        <span>{ticket.name}</span>\r\n                        <span className=\"text-blue-600\">{formatPrice(ticket.price_cents)}</span>\r\n                      </CardTitle>\r\n                      <CardDescription>隰帛ｸｫ: {ticket.teacher_id}</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <div className=\"text-sm text-gray-600 mb-3\">\r\n                        <div>譎る俣: {ticket.minutes}蛻・ﾃ・{ticket.bundle_qty}蝗・/div>\r\n                        <div>譛牙柑譛滄剞: {ticket.valid_days}譌･</div>\r\n                      </div>\r\n                      <Button onClick={() => handlePurchase(ticket)} disabled={!ticket.stripe_price_id}>\r\n                        <ShoppingCart className=\"w-4 h-4 mr-1\" /> 雉ｼ蜈･縺吶ｋ\r\n                      </Button>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Ticket Balances */}\r\n        <Card className=\"mb-8\">\r\n          <CardHeader>\r\n            <CardTitle>繝√こ繝・ヨ谿矩ｫ・/CardTitle>\r\n            <CardDescription>菫晄怏荳ｭ縺ｮ繝√こ繝・ヨ</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {balances.length === 0 ? (\r\n              <div className=\"text-gray-500\">繝√こ繝・ヨ縺ｯ縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n            ) : (\r\n                      <Table>\r\n                <TableHeader>\r\n                  <TableRow>\r\n                    <TableHead>繝√こ繝・ヨ蜷・/TableHead>\r\n                    <TableHead>谿九ｊ</TableHead>\r\n                    <TableHead>雉ｼ蜈･譌･</TableHead>\r\n                    <TableHead>譛牙柑譛滄剞</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                      {balances.map((b) => (\r\n                        <TableRow key={b.id}>\r\n                      <TableCell>{b.ticket_id}</TableCell>\r\n                      <TableCell>{b.remaining_minutes}蛻・/TableCell>\r\n                      <TableCell>{b.purchased_at ?? '-'}</TableCell>\r\n                      <TableCell>{b.expires_at ?? '-'}</TableCell>\r\n                    </TableRow>\r\n                  ))}\r\n                </TableBody>\r\n              </Table>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Purchase Dialog */}\r\n        <Dialog open={showPurchaseDialog} onOpenChange={setShowPurchaseDialog}>\r\n          <DialogContent>\r\n            <DialogHeader>\r\n              <DialogTitle>繝√こ繝・ヨ縺ｮ雉ｼ蜈･遒ｺ隱・/DialogTitle>\r\n              <DialogDescription>\r\n                {selectedTicket && (\r\n                  <div className=\"text-sm text-gray-700\">\r\n                    <div className=\"font-medium\">{selectedTicket.name}</div>\r\n                    <div className=\"mt-1\">萓｡譬ｼ: {formatPrice(selectedTicket.price_cents)}</div>\r\n                    <div className=\"mt-1\">譎る俣: {selectedTicket.minutes}蛻・ﾃ・{selectedTicket.bundle_qty}蝗・/div>\r\n                  </div>\r\n                )}\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <div className=\"flex justify-end gap-2\">\r\n              <Button variant=\"outline\" onClick={() => setShowPurchaseDialog(false)}>繧ｭ繝｣繝ｳ繧ｻ繝ｫ</Button>\r\n              <Button onClick={handleStripeCheckout} disabled={!selectedTicket || purchasing}>\r\n                {purchasing ? '蜃ｦ逅・ｸｭ...' : '雉ｼ蜈･縺ｫ騾ｲ繧'}\r\n              </Button>\r\n            </div>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\legal\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\teacher\\[handle]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TeacherRow' is defined but never used.","line":3,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[169,172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[169,172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AvailabilityRow' is defined but never used.","line":11,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TicketRow' is defined but never used.","line":12,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server'\r\n\r\ntype TeacherRow = {\r\n  id: string\r\n  handle: string\r\n  subjects: string[]\r\n  grades: string[]\r\n  public_profile: any\r\n}\r\n\r\ntype AvailabilityRow = { id: string; slot_start: string; slot_end: string }\r\ntype TicketRow = { id: string; name: string; minutes: number; bundle_qty: number; price_cents: number }\r\n\r\nexport default async function PublicTeacherPage({ params }: { params: { handle: string } }) {\r\n  const supabase = await createClient()\r\n  const { data: teacher } = await supabase\r\n    .from('teachers')\r\n    .select('id,handle,subjects,grades,public_profile')\r\n    .eq('handle', params.handle)\r\n    .maybeSingle()\r\n\r\n  if (!teacher) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-10\">\r\n        <h1 className=\"text-2xl font-bold\">隰帛ｸｫ縺瑚ｦ九▽縺九ｊ縺ｾ縺帙ｓ</h1>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const { data: avail } = await supabase\r\n    .from('availability')\r\n    .select('id,slot_start,slot_end')\r\n    .eq('teacher_id', teacher.id)\r\n    .eq('is_bookable', true)\r\n    .order('slot_start', { ascending: true })\r\n    .limit(10)\r\n\r\n  const { data: tickets } = await supabase\r\n    .from('tickets')\r\n    .select('id,name,minutes,bundle_qty,price_cents')\r\n    .eq('teacher_id', teacher.id)\r\n    .eq('is_active', true)\r\n    .order('price_cents', { ascending: true })\r\n    .limit(10)\r\n\r\n  const formatYen = (cents: number) => new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format((cents||0)/100)\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-10\">\r\n      <h1 className=\"text-2xl font-bold mb-2\">{teacher.handle}</h1>\r\n      <p className=\"text-gray-600 mb-6\">遘醍岼: {(teacher.subjects||[]).join(' / ')} 繝ｻ 蟄ｦ蟷ｴ: {(teacher.grades||[]).join(' / ')}</p>\r\n\r\n      <div className=\"grid md:grid-cols-2 gap-6\">\r\n        <div>\r\n          <h2 className=\"font-semibold mb-2\">莠育ｴ・庄閭ｽ縺ｪ譫・井ｾ具ｼ・/h2>\r\n          {!avail || avail.length === 0 ? (\r\n            <div className=\"text-gray-500\">蜈ｬ髢九＆繧後※縺・ｋ遨ｺ縺肴棧縺ｯ縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n          ) : (\r\n            <ul className=\"text-sm text-gray-700 space-y-1\">\r\n              {avail.map(a => (\r\n                <li key={a.id} className=\"border rounded p-2\">\r\n                  {new Date(a.slot_start).toLocaleString('ja-JP')} - {new Date(a.slot_end).toLocaleTimeString('ja-JP')}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          )}\r\n        </div>\r\n        <div>\r\n          <h2 className=\"font-semibold mb-2\">蜈ｬ髢倶ｸｭ縺ｮ繝√こ繝・ヨ</h2>\r\n          {!tickets || tickets.length === 0 ? (\r\n            <div className=\"text-gray-500\">蜈ｬ髢九＆繧後※縺・ｋ繝√こ繝・ヨ縺ｯ縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n          ) : (\r\n            <ul className=\"text-sm text-gray-700 space-y-1\">\r\n              {tickets.map(t => (\r\n                <li key={t.id} className=\"border rounded p-2\">\r\n                  {t.name}・・t.minutes}蛻・ﾃ・{t.bundle_qty}蝗橸ｼ・窶・{formatYen(t.price_cents)}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\teacher\\bookings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1393,1396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1393,1396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { format } from 'date-fns'\r\nimport { ja } from 'date-fns/locale'\r\n\r\ntype BookingRow = { id: string; start_time: string; end_time: string; status: 'pending'|'confirmed'|'canceled'|'done'; student_id: string }\r\n\r\nexport default function TeacherBookingsPage() {\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [items, setItems] = useState<BookingRow[]>([])\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setError(null); setLoading(true)\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (!uid) { setItems([]); return }\r\n        const { data, error } = await supabase\r\n          .from('bookings')\r\n          .select('id,start_time,end_time,status,student_id')\r\n          .eq('teacher_id', uid)\r\n          .order('start_time', { ascending: false })\r\n          .limit(200)\r\n        if (error) throw error\r\n        if (mounted) setItems(data || [])\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load(); return () => { mounted = false }\r\n  }, [supabase])\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={[\"teacher\"]}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <h1 className=\"text-2xl font-bold mb-4\">莠育ｴ・ｸ隕ｧ</h1>\r\n        {error && (<div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">{error}</div>)}\r\n        {loading ? (\r\n          <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n        ) : items.length === 0 ? (\r\n          <div className=\"text-gray-500\">莠育ｴ・・縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {items.map((b) => (\r\n              <Card key={b.id}>\r\n                <CardHeader><CardTitle className=\"text-sm\">逕溷ｾ棚D: {b.student_id}</CardTitle></CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-sm text-gray-700\">\r\n                    {format(new Date(b.start_time), 'PPP p', { locale: ja })} - {format(new Date(b.end_time), 'p', { locale: ja })}\r\n                    <span className=\"ml-2 inline-block rounded px-2 py-0.5 text-xs border\">{b.status}</span>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\teacher\\calendar\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2070,2073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2070,2073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { format } from 'date-fns'\r\nimport { ja } from 'date-fns/locale'\r\n\r\ntype ShiftRow = { id: string; start_time: string; end_time: string; rrule: string | null; is_published: boolean | null }\r\ntype AvailabilityRow = { id: string; slot_start: string; slot_end: string; is_bookable: boolean }\r\n\r\nexport default function TeacherCalendarPage() {\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [shifts, setShifts] = useState<ShiftRow[]>([])\r\n  const [avail, setAvail] = useState<AvailabilityRow[]>([])\r\n\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setError(null); setLoading(true)\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (!uid) { setShifts([]); setAvail([]); return }\r\n        const { data: s, error: sErr } = await supabase\r\n          .from('shifts')\r\n          .select('id,start_time,end_time,rrule,is_published')\r\n          .eq('teacher_id', uid)\r\n          .order('start_time', { ascending: true })\r\n          .limit(100)\r\n        if (sErr) throw sErr\r\n        const start = new Date(); const end = new Date(); end.setDate(end.getDate()+14)\r\n        const { data: a, error: aErr } = await supabase\r\n          .from('availability')\r\n          .select('id,slot_start,slot_end,is_bookable')\r\n          .eq('teacher_id', uid)\r\n          .gte('slot_start', start.toISOString())\r\n          .lte('slot_start', end.toISOString())\r\n          .order('slot_start', { ascending: true })\r\n          .limit(200)\r\n        if (aErr) throw aErr\r\n        if (mounted) { setShifts(s || []); setAvail(a || []) }\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load(); return () => { mounted = false }\r\n  }, [supabase])\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={[\"teacher\"]}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <Card className=\"mb-6\">\r\n          <CardHeader>\r\n            <CardTitle>繧ｷ繝輔ヨ</CardTitle>\r\n            <CardDescription>逋ｻ骭ｲ貂医∩縺ｮ繧ｷ繝輔ヨ</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {error && <div className=\"mb-3 text-sm text-red-700 bg-red-50 border border-red-200 p-2 rounded\">{error}</div>}\r\n            {loading ? (\r\n              <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n            ) : shifts.length === 0 ? (\r\n              <div className=\"text-gray-500\">繧ｷ繝輔ヨ縺ｯ縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n            ) : (\r\n              <ul className=\"text-sm text-gray-700 space-y-1\">\r\n                {shifts.map(s => (\r\n                  <li key={s.id} className=\"border rounded p-2\">\r\n                    {format(new Date(s.start_time), 'PPP p', { locale: ja })} - {format(new Date(s.end_time), 'p', { locale: ja })}\r\n                    {s.rrule && <span className=\"ml-2 text-xs text-gray-500\">RRULE: {s.rrule}</span>}\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>遨ｺ縺肴棧・・騾ｱ髢難ｼ・/CardTitle>\r\n            <CardDescription>莠育ｴ・庄閭ｽ縺ｪ譎る俣蟶ｯ</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {loading ? (\r\n              <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n            ) : avail.length === 0 ? (\r\n              <div className=\"text-gray-500\">遨ｺ縺肴棧縺ｯ縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n            ) : (\r\n              <ul className=\"text-sm text-gray-700 space-y-1\">\r\n                {avail.map(a => (\r\n                  <li key={a.id} className=\"border rounded p-2\">\r\n                    {format(new Date(a.slot_start), 'PPP p', { locale: ja })} - {format(new Date(a.slot_end), 'p', { locale: ja })}\r\n                    <span className=\"ml-2 text-xs border rounded px-2 py-0.5\">{a.is_bookable ? '莠育ｴ・庄' : '莠育ｴ・ｸ榊庄'}</span>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\teacher\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BookingRow' is defined but never used.","line":18,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport Link from 'next/link'\r\nimport { Calendar, DollarSign, FileText, Settings } from 'lucide-react'\r\nimport { useAuth } from '@/hooks/use-auth'\r\nimport { useBookings } from '@/hooks/use-bookings'\r\nimport { useTickets } from '@/hooks/use-tickets'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { format } from 'date-fns'\r\nimport { ja } from 'date-fns/locale'\r\nimport { Booking, Ticket, Payment } from '@/lib/types/database'\r\n\r\ntype BookingRow = {\r\n  id: string\r\n  start_time: string\r\n  end_time: string\r\n  status: 'pending' | 'confirmed' | 'canceled' | 'done'\r\n  student_id: string\r\n}\r\n\r\nexport default function TeacherDashboard() {\r\n  const { user, dbUser, loading: authLoading } = useAuth()\r\n  const { bookings, loading: bookingsLoading } = useBookings(user?.id, 'teacher')\r\n  const { tickets: activeTickets, loading: ticketsLoading } = useTickets(user?.id, 'teacher')\r\n  const [monthRevenue, setMonthRevenue] = useState(0)\r\n  const [revenueLoading, setRevenueLoading] = useState(false)\r\n\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    if (!user?.id || dbUser?.role !== 'teacher') return\r\n\r\n    async function fetchRevenue() {\r\n      setRevenueLoading(true)\r\n      const start = new Date()\r\n      start.setDate(1)\r\n      const { data: pays } = await supabase\r\n        .from('payments')\r\n        .select('amount_cents')\r\n        .eq('teacher_id', user!.id)\r\n        .eq('status', 'completed')\r\n        .gte('created_at', start.toISOString())\r\n\r\n      const rev = ((pays || []) as Payment[]).reduce((acc: number, p: Payment) => acc + (p.amount_cents || 0), 0)\r\n      setMonthRevenue(rev)\r\n      setRevenueLoading(false)\r\n    }\r\n    fetchRevenue()\r\n  }, [user, dbUser, supabase])\r\n\r\n  const upcoming = useMemo(() => bookings.filter((b: Booking) => b.status === 'confirmed').slice(0, 5), [bookings])\r\n  const activeTicketCount = useMemo(() => activeTickets.filter((t: Ticket) => t.is_active).length, [activeTickets])\r\n  const studentCount = useMemo(() => new Set(bookings.map((b: Booking) => b.student_id)).size, [bookings])\r\n\r\n  const loading = authLoading || bookingsLoading || ticketsLoading || revenueLoading\r\n  const error = null\r\n\r\n  const formatYen = (cents: number) =>\r\n    new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format((cents || 0) / 100)\r\n\r\n  const quickActions = [\r\n    { title: '繧ｫ繝ｬ繝ｳ繝繝ｼ邂｡逅・, description: '繧ｷ繝輔ヨ縺ｨ遨ｺ縺肴凾髢薙ｒ險ｭ螳・, href: '/teacher/calendar', icon: Calendar },\r\n    { title: '繝√こ繝・ヨ邂｡逅・, description: '雋ｩ螢ｲ縺ｨ譛牙柑譛滄剞繧定ｨｭ螳・, href: '/teacher/tickets', icon: DollarSign },\r\n    { title: '繝ｬ繝昴・繝井ｽ懈・', description: '謗域･ｭ縺ｮ繝ｬ繝昴・繝医ｒ菴懈・', href: '/teacher/reports', icon: FileText },\r\n    { title: '繝励Ο繝輔ぅ繝ｼ繝ｫ險ｭ螳・, description: '蜈ｬ髢区ュ蝣ｱ縺ｮ險ｭ螳・, href: '/teacher/profile', icon: Settings },\r\n  ]\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={['teacher']}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">繝繝・す繝･繝懊・繝・/h1>\r\n          <p className=\"text-gray-600\">莠育ｴ・→繝√こ繝・ヨ縲∝｣ｲ荳翫・讎りｦ・/p>\r\n        </div>\r\n\r\n        {error && (\r\n          <div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">\r\n            繝・・繧ｿ蜿門ｾ励〒繧ｨ繝ｩ繝ｼ縺檎匱逕溘＠縺ｾ縺励◆: {error}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n          <Card>\r\n            <CardHeader className=\"pb-2\"><CardTitle className=\"text-sm text-gray-600\">莉頑怦縺ｮ螢ｲ荳・/CardTitle></CardHeader>\r\n            <CardContent><div className=\"text-2xl font-bold\">{formatYen(monthRevenue)}</div></CardContent>\r\n          </Card>\r\n          <Card>\r\n            <CardHeader className=\"pb-2\"><CardTitle className=\"text-sm text-gray-600\">繧｢繧ｯ繝・ぅ繝也函蠕・/CardTitle></CardHeader>\r\n            <CardContent><div className=\"text-2xl font-bold\">{studentCount}</div></CardContent>\r\n          </Card>\r\n          <Card>\r\n            <CardHeader className=\"pb-2\"><CardTitle className=\"text-sm text-gray-600\">蜈ｬ髢倶ｸｭ繝√こ繝・ヨ</CardTitle></CardHeader>\r\n            <CardContent><div className=\"text-2xl font-bold\">{activeTicketCount}</div></CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        <div className=\"grid lg:grid-cols-3 gap-8\">\r\n          <div className=\"lg:col-span-2\">\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>逶ｴ霑代・莠育ｴ・/CardTitle>\r\n                <CardDescription>縺薙ｌ縺九ｉ縺ｮ莠亥ｮ・/CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {loading ? (\r\n                  <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n                ) : upcoming.length === 0 ? (\r\n                  <div className=\"text-gray-500\">莠亥ｮ壹・縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n                ) : (\r\n                  <div className=\"space-y-3\">\r\n                    {upcoming.map((b: Booking) => (\r\n                      <div key={b.id} className=\"flex items-center justify-between p-3 border rounded\">\r\n                        <div>\r\n                          <div className=\"font-medium\">\r\n                            {format(new Date(b.start_time), 'PPPp', { locale: ja })}\r\n                            <span className=\"mx-1\">-</span>\r\n                            {format(new Date(b.end_time), 'p', { locale: ja })}\r\n                          </div>\r\n                          <div className=\"text-xs text-gray-600\">逕溷ｾ棚D: {b.student_id}</div>\r\n                        </div>\r\n                        <Badge variant={b.status === 'confirmed' ? 'default' : 'secondary'}>{b.status}</Badge>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          <div>\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>繧ｯ繧､繝・け繧｢繧ｯ繧ｷ繝ｧ繝ｳ</CardTitle>\r\n                <CardDescription>繧医￥菴ｿ縺・桃菴・/CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-3\">\r\n                  {quickActions.map((a) => {\r\n                    const Icon = a.icon\r\n                    return (\r\n                      <Link key={a.title} href={a.href}>\r\n                        <div className=\"flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors cursor-pointer\">\r\n                          <Icon className=\"h-5 w-5 text-blue-600 mr-3\" />\r\n                          <div>\r\n                            <div className=\"font-medium text-sm\">{a.title}</div>\r\n                            <div className=\"text-xs text-gray-600\">{a.description}</div>\r\n                          </div>\r\n                        </div>\r\n                      </Link>\r\n                    )\r\n                  })}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\teacher\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\teacher\\profile\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[446,449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[446,449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1323,1326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1323,1326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { createClient } from '@/lib/supabase/client'\r\n\r\ntype TeacherRow = {\r\n  id: string\r\n  handle: string\r\n  subjects: string[]\r\n  grades: string[]\r\n  plan: 'free' | 'pro'\r\n  public_profile: Record<string, any>\r\n}\r\n\r\nexport default function TeacherProfilePage() {\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [teacher, setTeacher] = useState<TeacherRow | null>(null)\r\n\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setError(null)\r\n        setLoading(true)\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (!uid) { setTeacher(null); return }\r\n        const { data, error } = await supabase\r\n          .from('teachers')\r\n          .select('id,handle,subjects,grades,plan,public_profile')\r\n          .eq('id', uid)\r\n          .maybeSingle()\r\n        if (error) throw error\r\n        if (mounted) setTeacher(data)\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load()\r\n    return () => { mounted = false }\r\n  }, [supabase])\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={[\"teacher\"]}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>繝励Ο繝輔ぅ繝ｼ繝ｫ</CardTitle>\r\n            <CardDescription>蜈ｬ髢九・繝ｭ繝輔ぅ繝ｼ繝ｫ縺ｮ讎りｦ・/CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {error && (\r\n              <div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">{error}</div>\r\n            )}\r\n            {loading ? (\r\n              <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n            ) : !teacher ? (\r\n              <div className=\"text-gray-500\">繝励Ο繝輔ぅ繝ｼ繝ｫ縺瑚ｦ九▽縺九ｊ縺ｾ縺帙ｓ縲・/div>\r\n            ) : (\r\n              <div className=\"text-sm text-gray-700 space-y-2\">\r\n                <div><span className=\"font-medium\">繝上Φ繝峨Ν:</span> {teacher.handle}</div>\r\n                <div><span className=\"font-medium\">遘醍岼:</span> {(teacher.subjects || []).join(' / ') || '-'}</div>\r\n                <div><span className=\"font-medium\">蟄ｦ蟷ｴ:</span> {(teacher.grades || []).join(' / ') || '-'}</div>\r\n                <div><span className=\"font-medium\">繝励Λ繝ｳ:</span> {teacher.plan}</div>\r\n                <div>\r\n                  <span className=\"font-medium\">蜈ｬ髢九・繝ｭ繝輔ぅ繝ｼ繝ｫ:</span>\r\n                  <pre className=\"mt-1 p-2 bg-gray-50 border rounded overflow-x-auto\">{JSON.stringify(teacher.public_profile || {}, null, 2)}</pre>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\teacher\\reports\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1819,1822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1819,1822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { format } from 'date-fns'\r\nimport { ja } from 'date-fns/locale'\r\n\r\ntype ReportRow = { id: string; booking_id: string; published_at: string | null; content_raw: string | null; content_public: string | null }\r\n\r\nexport default function TeacherReportsPage() {\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [items, setItems] = useState<ReportRow[]>([])\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setError(null); setLoading(true)\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (!uid) { setItems([]); return }\r\n        // bookings for teacher\r\n        const { data: bookings, error: bErr } = await supabase\r\n          .from('bookings')\r\n          .select('id')\r\n          .eq('teacher_id', uid)\r\n          .order('start_time', { ascending: false })\r\n          .limit(200)\r\n        if (bErr) throw bErr\r\n        const bIds = (bookings || []).map(b => b.id)\r\n        if (bIds.length === 0) { setItems([]); return }\r\n        const { data: reps, error: rErr } = await supabase\r\n          .from('reports')\r\n          .select('id,booking_id,published_at,content_raw,content_public')\r\n          .in('booking_id', bIds)\r\n          .order('published_at', { ascending: false })\r\n          .limit(100)\r\n        if (rErr) throw rErr\r\n        if (mounted) setItems(reps || [])\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load(); return () => { mounted = false }\r\n  }, [supabase])\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={[\"teacher\"]}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <h1 className=\"text-2xl font-bold mb-4\">繝ｬ繝昴・繝・/h1>\r\n        {error && (<div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">{error}</div>)}\r\n        {loading ? (\r\n          <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n        ) : items.length === 0 ? (\r\n          <div className=\"text-gray-500\">繝ｬ繝昴・繝医・縺ゅｊ縺ｾ縺帙ｓ縲・/div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {items.map((r) => (\r\n              <Card key={r.id}>\r\n                <CardHeader>\r\n                  <CardTitle className=\"text-sm\">{r.published_at ? format(new Date(r.published_at), 'PPP', { locale: ja }) : '譛ｪ蜈ｬ髢・}</CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"text-sm text-gray-700 line-clamp-3\">\r\n                    {r.content_public ?? r.content_raw ?? '・亥・螳ｹ縺ｪ縺暦ｼ・}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\charl\\EdBrio\\src\\app\\teacher\\tickets\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1383,1386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1383,1386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useEffect, useMemo, useState } from 'react'\r\nimport { ProtectedRoute } from '@/components/layout/protected-route'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { createClient } from '@/lib/supabase/client'\r\n\r\ntype TicketRow = {\r\n  id: string\r\n  name: string\r\n  minutes: number\r\n  bundle_qty: number\r\n  price_cents: number\r\n  valid_days: number\r\n  is_active: boolean\r\n}\r\n\r\nexport default function TeacherTicketsPage() {\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [items, setItems] = useState<TicketRow[]>([])\r\n\r\n  const supabase = useMemo(() => createClient(), [])\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    async function load() {\r\n      try {\r\n        setError(null)\r\n        setLoading(true)\r\n        const { data: session } = await supabase.auth.getSession()\r\n        const uid = session.session?.user?.id\r\n        if (!uid) { setItems([]); return }\r\n        const { data, error } = await supabase\r\n          .from('tickets')\r\n          .select('id,name,minutes,bundle_qty,price_cents,valid_days,is_active')\r\n          .eq('teacher_id', uid)\r\n          .order('created_at', { ascending: false })\r\n          .limit(100)\r\n        if (error) throw error\r\n        if (mounted) setItems(data || [])\r\n      } catch (e: any) {\r\n        setError(e?.message || String(e))\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    }\r\n    load()\r\n    return () => { mounted = false }\r\n  }, [supabase])\r\n\r\n  const formatYen = (cents: number) => new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format((cents||0)/100)\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={[\"teacher\"]}>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>繝√こ繝・ヨ</CardTitle>\r\n            <CardDescription>雋ｩ螢ｲ荳ｭ縺ｮ繝√こ繝・ヨ荳隕ｧ</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {error && (<div className=\"mb-4 p-3 text-sm bg-red-50 border border-red-200 rounded text-red-700\">{error}</div>)}\r\n            {loading ? (\r\n              <div className=\"text-gray-500\">隱ｭ縺ｿ霎ｼ縺ｿ荳ｭ...</div>\r\n            ) : items.length === 0 ? (\r\n              <div className=\"text-gray-500\">繝√こ繝・ヨ縺後≠繧翫∪縺帙ｓ縲・/div>\r\n            ) : (\r\n              <div className=\"grid md:grid-cols-2 gap-4\">\r\n                {items.map((t) => (\r\n                  <Card key={t.id}>\r\n                    <CardHeader>\r\n                      <CardTitle className=\"text-sm\">{t.name}</CardTitle>\r\n                      <CardDescription>{t.is_active ? '蜈ｬ髢倶ｸｭ' : '髱槫・髢・}</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <div className=\"text-sm text-gray-700 space-y-1\">\r\n                        <div>譎る俣: {t.minutes}蛻・ﾃ・{t.bundle_qty}蝗・/div>\r\n                        <div>萓｡譬ｼ: {formatYen(t.price_cents)}</div>\r\n                        <div>譛牙柑譛滄剞: {t.valid_days}譌･</div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n\r\n","usedDeprecatedRules":[]}]
